<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Klik Counter</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #000; height: 100vh; font-family: Arial, sans-serif; }
.counter { 
    position: absolute; 
    top: 50%; 
    left: 50%; 
    transform: translate(-50%, -250%); 
    font-size: 5rem; 
    color: #fff; 
    font-family: 'Arial Black', sans-serif; 
    z-index: 2; 
    text-shadow: 0 0 15px #fff;
    font-weight: 900;
}
.circle { 
    position: absolute; 
    top: 50%; 
    left: 50%; 
    transform: translate(-50%, -50%); 
    width: 200px; 
    height: 200px; 
    border-radius: 50%; 
    cursor: pointer; 
    border: 3px solid #fff; 
    overflow: hidden; 
    z-index: 1;
}
.circle img { width: 100%; height: 100%; object-fit: cover; }
.btn { 
    position: fixed; 
    top: 20px; 
    right: 20px; 
    width: 50px; 
    height: 50px; 
    background: #000; 
    color: #fff; 
    border: 2px solid #fff; 
    border-radius: 50%; 
    cursor: pointer; 
    z-index: 100; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    font-size: 1.2rem;
}
.panel { 
    position: fixed; 
    top: 0; 
    right: -400px; 
    width: 380px; 
    height: 100vh; 
    background: #000; 
    border-left: 2px solid #444; 
    transition: 0.3s; 
    z-index: 99; 
    display: flex; 
    flex-direction: column;
}
.panel.open { right: 0; }
.header { 
    padding: 20px; 
    border-bottom: 2px solid #444; 
    display: flex; 
    justify-content: space-between; 
    align-items: center;
}
.header h2 { color: #fff; font-size: 1.4rem; }
.close { background: none; border: none; color: #fff; cursor: pointer; font-size: 1.5rem; }
.auth { padding: 20px; border-bottom: 2px solid #444; }
.form { display: none; flex-direction: column; gap: 15px; }
.form.active { display: flex; }
.btns { display: flex; gap: 10px; }
.auth-btn { 
    flex: 1; 
    padding: 10px; 
    background: #333; 
    color: #fff; 
    border: 1px solid #666; 
    cursor: pointer; 
    border-radius: 4px;
}
.input { display: flex; flex-direction: column; gap: 8px; }
.input label { color: #ccc; font-size: 0.9rem; }
.input input { 
    padding: 10px; 
    background: #111; 
    border: 1px solid #444; 
    color: #fff; 
    border-radius: 4px;
}
.submit { 
    padding: 10px; 
    background: #444; 
    color: #fff; 
    border: none; 
    cursor: pointer; 
    border-radius: 4px;
}
.content { 
    flex: 1; 
    overflow-y: auto; 
    padding: 15px;
}
.item { 
    display: flex; 
    align-items: center; 
    padding: 12px; 
    background: #111; 
    border: 1px solid #333; 
    margin-bottom: 8px; 
    border-radius: 6px;
}
.item.current { border-color: #fff; background: #222; }
.rank { width: 40px; color: #fff; font-weight: bold; font-size: 1.2rem; }
.info { flex: 1; margin-left: 15px; }
.name { color: #fff; font-size: 1rem; }
.score { color: #fff; font-weight: bold; font-size: 1.1rem; }
.error { color: #ff4444; font-size: 0.8rem; display: none; }
.error.show { display: block; }
</style>
</head>
<body>
<div class="counter" id="counter">0</div>
<div class="circle" id="circle">
    <div style="width:100%;height:100%;background:#333;display:flex;align-items:center;justify-content:center;color:#fff;font-size:3rem;">
        <i class="fas fa-mouse-pointer"></i>
    </div>
</div>
<button class="btn" id="toggle"><i class="fas fa-trophy"></i></button>
<div class="panel" id="panel">
<div class="header">
    <h2><i class="fas fa-crown"></i> LEADERBOARD</h2>
    <button class="close" id="close"><i class="fas fa-times"></i></button>
</div>
<div class="auth">
    <div class="btns">
        <button class="auth-btn" id="showLogin"><i class="fas fa-sign-in-alt"></i> Login</button>
        <button class="auth-btn" id="showRegister"><i class="fas fa-user-plus"></i> Register</button>
    </div>
    <div class="form" id="loginForm">
        <div class="input">
            <label><i class="fas fa-user"></i> Username</label>
            <input type="text" id="user">
        </div>
        <div class="input">
            <label><i class="fas fa-lock"></i> Password</label>
            <input type="password" id="pass">
        </div>
        <div class="error" id="loginErr"></div>
        <button class="submit" id="loginBtn"><i class="fas fa-sign-in-alt"></i> Login</button>
    </div>
    <div class="form" id="registerForm">
        <div class="input">
            <label><i class="fas fa-user"></i> Username</label>
            <input type="text" id="regUser">
        </div>
        <div class="input">
            <label><i class="fas fa-lock"></i> Password</label>
            <input type="password" id="regPass">
        </div>
        <div class="error" id="regErr"></div>
        <button class="submit" id="regBtn"><i class="fas fa-user-plus"></i> Register</button>
    </div>
</div>
<div class="content" id="content">
    <div class="item">
        <div class="rank">1</div>
        <div class="info">
            <div class="name">Klik lingkaran untuk mulai</div>
        </div>
        <div class="score">0</div>
    </div>
</div>
</div>

<script>
// Variabel global
let clicks = 0;
let currentUser = null;
let audio = null;

// DOM Elements
const counter = document.getElementById('counter');
const circle = document.getElementById('circle');
const toggle = document.getElementById('toggle');
const panel = document.getElementById('panel');
const closeBtn = document.getElementById('close');
const showLogin = document.getElementById('showLogin');
const showRegister = document.getElementById('showRegister');
const loginForm = document.getElementById('loginForm');
const registerForm = document.getElementById('registerForm');
const loginBtn = document.getElementById('loginBtn');
const regBtn = document.getElementById('regBtn');
const userInput = document.getElementById('user');
const passInput = document.getElementById('pass');
const regUserInput = document.getElementById('regUser');
const regPassInput = document.getElementById('regPass');
const content = document.getElementById('content');
const loginErr = document.getElementById('loginErr');
const regErr = document.getElementById('regErr');

// Initialize Supabase
const SUPABASE_URL = 'https://bxhrnnwfqlsoviysqcdw.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ4aHJubndmcWxzb3ZpeXNxY2R3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU3ODkzNDIsImV4cCI6MjA4MTM2NTM0Mn0.O7fpv0TrDd-8ZE3Z9B5zWyAuWROPis5GRnKMxmqncX8';

const supabase = window.supabase ? window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY) : null;

// Initialize audio
try {
    audio = new Audio('suara.mp3');
    audio.volume = 0.3;
    audio.preload = 'auto';
} catch(e) {
    console.log("Audio tidak tersedia");
}

// Event Listeners
document.addEventListener('DOMContentLoaded', function() {
    // Klik pada lingkaran
    circle.addEventListener('click', handleClick);
    
    // Tombol leaderboard
    toggle.addEventListener('click', function() {
        panel.classList.toggle('open');
    });
    
    // Tombol close panel
    closeBtn.addEventListener('click', function() {
        panel.classList.remove('open');
    });
    
    // Form login/register
    showLogin.addEventListener('click', function() {
        loginForm.classList.add('active');
        registerForm.classList.remove('active');
        showLogin.style.display = 'none';
        showRegister.style.display = 'none';
        clearErrors();
    });
    
    showRegister.addEventListener('click', function() {
        registerForm.classList.add('active');
        loginForm.classList.remove('active');
        showLogin.style.display = 'none';
        showRegister.style.display = 'none';
        clearErrors();
    });
    
    // Tombol login
    loginBtn.addEventListener('click', handleLogin);
    
    // Tombol register
    regBtn.addEventListener('click', handleRegister);
    
    // Load leaderboard awal
    loadLeaderboard();
});

// Handle klik pada lingkaran
function handleClick() {
    clicks++;
    counter.textContent = clicks;
    
    // Efek visual
    counter.style.textShadow = '0 0 20px #fff, 0 0 30px #fff';
    setTimeout(() => {
        counter.style.textShadow = '0 0 15px #fff';
    }, 100);
    
    // Efek klik pada lingkaran
    circle.style.transform = 'translate(-50%, -50%) scale(0.95)';
    setTimeout(() => {
        circle.style.transform = 'translate(-50%, -50%) scale(1)';
    }, 100);
    
    // Play suara
    playSound();
    
    // Update skor jika user login
    if (currentUser && supabase) {
        updateScore();
    }
}

// Play suara
function playSound() {
    if (!audio) return;
    
    try {
        const audioClone = audio.cloneNode();
        audioClone.volume = 0.3;
        audioClone.play().catch(e => {
            console.log("Gagal memainkan suara:", e);
        });
    } catch(e) {
        console.log("Error playing sound:", e);
    }
}

// Handle login
async function handleLogin() {
    const username = userInput.value.trim();
    const password = passInput.value.trim();
    
    if (!username || !password) {
        showError(loginErr, "Username dan password harus diisi");
        return;
    }
    
    if (!supabase) {
        showError(loginErr, "Database tidak terhubung");
        return;
    }
    
    try {
        const { data, error } = await supabase
            .from('USER_KLIK')
            .select('*')
            .eq('username', username)
            .eq('password', password)
            .single();
        
        if (error || !data) {
            showError(loginErr, "Username atau password salah");
            return;
        }
        
        // Login berhasil
        currentUser = {
            id: data.id,
            username: data.username,
            click_count: data.click_count || 0
        };
        
        // Update counter
        clicks = currentUser.click_count;
        counter.textContent = clicks;
        
        // Tampilkan pesan sukses
        showAuthButtons();
        loadLeaderboard();
        
    } catch (error) {
        showError(loginErr, "Terjadi kesalahan");
        console.error("Login error:", error);
    }
}

// Handle register
async function handleRegister() {
    const username = regUserInput.value.trim();
    const password = regPassInput.value.trim();
    
    if (!username || !password) {
        showError(regErr, "Username dan password harus diisi");
        return;
    }
    
    if (password.length < 4) {
        showError(regErr, "Password minimal 4 karakter");
        return;
    }
    
    if (!supabase) {
        showError(regErr, "Database tidak terhubung");
        return;
    }
    
    try {
        // Cek apakah username sudah ada
        const { data: existing } = await supabase
            .from('USER_KLIK')
            .select('id')
            .eq('username', username)
            .single();
        
        if (existing) {
            showError(regErr, "Username sudah digunakan");
            return;
        }
        
        // Buat user baru
        const { data: newUser, error } = await supabase
            .from('USER_KLIK')
            .insert([
                { 
                    username: username, 
                    password: password,
                    click_count: 0
                }
            ])
            .select()
            .single();
        
        if (error) {
            showError(regErr, "Gagal membuat akun");
            return;
        }
        
        currentUser = {
            id: newUser.id,
            username: newUser.username,
            click_count: 0
        };
        
        showAuthButtons();
        loadLeaderboard();
        
    } catch (error) {
        showError(regErr, "Terjadi kesalahan");
        console.error("Register error:", error);
    }
}

// Update skor ke database
async function updateScore() {
    if (!currentUser || !supabase) return;
    
    try {
        await supabase
            .from('USER_KLIK')
            .update({ click_count: clicks })
            .eq('id', currentUser.id);
        
        loadLeaderboard();
    } catch (error) {
        console.error("Update score error:", error);
    }
}

// Load leaderboard
async function loadLeaderboard() {
    if (!supabase) {
        content.innerHTML = '<div class="item"><div class="info"><div class="name">Database tidak terhubung</div></div></div>';
        return;
    }
    
    try {
        const { data, error } = await supabase
            .from('USER_KLIK')
            .select('username, click_count')
            .order('click_count', { ascending: false });
        
        if (error) {
            content.innerHTML = '<div class="item"><div class="info"><div class="name">Error loading data</div></div></div>';
            return;
        }
        
        if (!data || data.length === 0) {
            content.innerHTML = '<div class="item"><div class="info"><div class="name">Belum ada data</div></div></div>';
            return;
        }
        
        let html = '';
        data.forEach((user, index) => {
            const isCurrent = currentUser && user.username === currentUser.username;
            html += `
                <div class="item ${isCurrent ? 'current' : ''}">
                    <div class="rank">${index + 1}</div>
                    <div class="info">
                        <div class="name">${user.username || 'Unknown'}</div>
                    </div>
                    <div class="score">${user.click_count || 0}</div>
                </div>
            `;
        });
        
        content.innerHTML = html;
        
    } catch (error) {
        console.error("Load leaderboard error:", error);
        content.innerHTML = '<div class="item"><div class="info"><div class="name">Error loading leaderboard</div></div></div>';
    }
}

// Tampilkan tombol auth
function showAuthButtons() {
    loginForm.classList.remove('active');
    registerForm.classList.remove('active');
    showLogin.style.display = 'block';
    showRegister.style.display = 'block';
    userInput.value = '';
    passInput.value = '';
    regUserInput.value = '';
    regPassInput.value = '';
    clearErrors();
}

// Tampilkan error
function showError(element, message) {
    element.textContent = message;
    element.classList.add('show');
    setTimeout(() => {
        element.classList.remove('show');
    }, 3000);
}

// Hapus semua error
function clearErrors() {
    loginErr.classList.remove('show');
    regErr.classList.remove('show');
}
</script>
</body>
</html>
